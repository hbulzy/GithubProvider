os: Visual Studio 2015

environment:
  GITHUB_TOKEN:
    secure: XHO7MYVx17hrAWLVGs1eGJZcIRczb4ddHrFZj/Be3mVO54ITNLpXR5uquH/9MqAl
  PSGALLERY_TOKEN:
    secure: yljpqxZjLKG2ZxEbEN6u07UxOyDOGiAbIhA64CN9BVCoRPSzZTykdtQ9r/kAztJG
    
configuration:
  - Debug
  - Release    

install:
  - ps: $env:PATH=("C:\Program Files (x86)\MSBuild\14.0\Bin;"+$env:PATH)
  - ps: mkdir c:/Modules
  - ps: $env:PSModulePath += ";c:\Modules\"
  - ps: $msiPath = "$($env:USERPROFILE)\PackageManagement_x64.msi"
  - ps: (New-Object Net.WebClient).DownloadFile('https://download.microsoft.com/download/4/1/A/41A369FA-AA36-4EE9-845B-20BCC1691FC5/PackageManagement_x64.msi', $msiPath)
  - ps: cmd /c start /wait msiexec /i $msiPath /quiet
  - ps: Install-Module -Name Pester
    
before_build:
  - ps: pushd GithubProvider
  - ps: nuget restore
  - ps: popd    
    
test_script:
  - ps: .\test.ps1
    
deploy_script:
  - ps: cp GithubFS c:/Modules/GithubFS
  - ps: publish-module -Name GithubFS -NugetApiToken $env:PSGALLERY_TOKEN
    on:
      branch: master
      appveyor_repo_tag: true 
